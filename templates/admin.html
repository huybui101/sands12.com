{% extends "base.html" %}
{% set show_nav = false %}

{% block content %}
<section class="admin-page admin-light">
  <div class="admin-header">
    <div>
      <h2 data-i18n="admin_title">H·∫≠u ƒë√†i</h2>
      <p data-i18n="admin_subtitle">Qu·∫£n l√Ω giao di·ªán, logo, banner, tr√≤ ch∆°i v√† t·ª∑ l·ªá c∆∞·ª£c.</p>
    </div>
    <div class="admin-meta">
      <span data-i18n="admin_last_update">C·∫≠p nh·∫≠t l·∫ßn cu·ªëi</span>
      <strong>{{ config.updated_at if config.updated_at else 'Ch∆∞a c√≥' }}</strong>
    </div>
  </div>

  <div class="admin-layout">
    <aside class="admin-sidebar">
      <nav class="admin-menu">
        <a class="menu-pill" href="#section-home" data-section="section-home" data-i18n="admin_menu_home">TRANG CH·ª¶</a>
        <a class="menu-pill" href="#section-stats" data-section="section-stats" data-i18n="admin_menu_stats">TH·ªêNG K√ä</a>
        <a class="menu-pill" href="#section-users" data-section="section-users" data-i18n="admin_menu_users">T√ÄI KHO·∫¢N KH√ÅCH</a>
        <a class="menu-pill" href="#section-approval" data-section="section-approval" data-i18n="admin_menu_approval">DUY·ªÜT N·∫†P R√öT</a>
        <a class="menu-pill" href="#section-banks" data-section="section-banks" data-i18n="admin_menu_banks">TH√îNG TIN NG√ÇN H√ÄNG</a>
        <a class="menu-pill" href="#section-cskh" data-section="section-cskh" data-i18n="admin_menu_cskh">CSKH ADMIN</a>
        <a class="menu-pill" href="#section-cskh-config" data-section="section-cskh-config" data-i18n="admin_menu_cskh_config">C·∫§U H√åNH CSKH</a>
        <a class="menu-pill" href="#section-ads" data-section="section-ads" data-i18n="admin_menu_ads">LOGO & QU·∫¢NG C√ÅO</a>
        <a class="menu-pill" href="#section-game-images" data-section="section-game-images" data-i18n="admin_menu_game_images">·∫¢NH TR√í CH∆†I</a>
        <a class="menu-pill" href="#section-add-game" data-section="section-add-game" data-i18n="admin_menu_add_game">TH√äM TR√í CH∆†I</a>
        <a class="menu-pill" href="#section-edit-game" data-section="section-edit-game">S·ª¨A T√äN TR√í CH∆†I</a>
        <a class="menu-pill" href="#section-bet-labels" data-section="section-bet-labels" data-i18n="admin_menu_bet_labels">S·ª¨A T√äN C·ª¨A C∆Ø·ª¢C</a>
        <a class="menu-pill" href="#section-theme" data-section="section-theme" data-i18n="admin_menu_theme">THAY ƒê·ªîI GIAO DI·ªÜN</a>
        <a class="menu-pill" href="#section-tips" data-section="section-tips" data-i18n="admin_menu_tips">M·∫∏O NH·ªé</a>
        <a class="menu-pill" href="#section-config" data-section="section-config" data-i18n="admin_menu_config">C√ÄI C·∫§U H√åNH</a>
        <a class="menu-pill" href="#section-fees" data-section="section-fees" data-i18n="admin_menu_fees">T√çNH TRI PH√ç N·∫†P R√öT</a>
        <a class="menu-pill" href="#section-odds" data-section="section-odds" data-i18n="admin_menu_odds">T√ôY CH·ªàNH ODDS</a>
      </nav>
    </aside>

    <div class="admin-main">
      <div class="admin-grid">
        <form method="post" class="admin-form admin-block" id="section-home" data-section="section-home">
      <input type="hidden" name="section" value="general" />
      <div class="admin-section">
        <h3 data-i18n="admin_general_info">Th√¥ng tin chung</h3>
        <div class="form-grid">
          <label><span data-i18n="admin_site_name">T√™n trang web</span><input type="text" name="site_name" value="{{ config.site_name }}" /></label>
          <label><span data-i18n="admin_odds_low">Odds 1.98</span><input type="number" step="0.01" name="odds_low" value="{{ config.odds_low }}" /></label>
          <label><span data-i18n="admin_odds_high">Odds 2.1</span><input type="number" step="0.01" name="odds_high" value="{{ config.odds_high }}" /></label>
        </div>
        <div class="form-grid">
          <label><span data-i18n="admin_theme_primary">M√†u ch·ªß ƒë·∫°o</span><input type="color" name="theme_primary" value="{{ config.theme_primary }}" /></label>
          <label><span data-i18n="admin_theme_accent">M√†u nh·∫•n</span><input type="color" name="theme_accent" value="{{ config.theme_accent }}" /></label>
        </div>
        <div class="admin-actions">
          <button class="btn primary" type="submit" data-i18n="admin_save_info">L∆∞u th√¥ng tin</button>
        </div>
      </div>
      </form>

      <form method="post" enctype="multipart/form-data" class="admin-form admin-block" id="section-ads" data-section="section-ads">
      <input type="hidden" name="section" value="logo" />
      <div class="admin-section">
        <h3 data-i18n="admin_logo_banner">Logo & Banner</h3>
        <label><span data-i18n="admin_logo_site">Logo trang web</span><input type="file" name="logo" accept="image/*" /></label>
        {% if config.logo %}
          <div class="preview-row">
            <img src="{{ config.logo }}" alt="Logo" />
            <label><input type="checkbox" name="clear_logo" /> <span data-i18n="admin_clear_logo">X√≥a logo</span></label>
          </div>
        {% endif %}

        <label><span data-i18n="admin_hero_images">·∫¢nh qu·∫£ng c√°o (hero)</span><input type="file" name="hero_images" accept="image/*" multiple /></label>
        {% if config.hero_images %}
          <div class="preview-grid">
            {% for hero in config.hero_images %}
              <label class="preview-item">
                <img src="{{ hero }}" alt="Hero" />
                <span><input type="checkbox" name="delete_heroes" value="{{ hero }}" /> X√≥a ·∫£nh n√†y</span>
              </label>
            {% endfor %}
          </div>
          <label><input type="checkbox" name="clear_heroes" /> <span data-i18n="admin_clear_heroes">X√≥a t·∫•t c·∫£ hero</span></label>
        {% endif %}

        <label><span>Banner ƒëƒÉng k√Ω/ƒëƒÉng nh·∫≠p</span><input type="file" name="landing_banner" accept="image/*" /></label>
        {% if config.landing_banner %}
          <div class="preview-row">
            <img src="{{ config.landing_banner }}" alt="Landing Banner" />
            <label><input type="checkbox" name="clear_landing_banner" /> <span>X√≥a banner ƒëƒÉng k√Ω/ƒëƒÉng nh·∫≠p</span></label>
          </div>
        {% endif %}
        <div class="admin-actions">
          <button class="btn primary" type="submit" data-i18n="admin_update_logo_banner">C·∫≠p nh·∫≠t logo/banner</button>
        </div>
      </div>
      </form>

      <form method="post" enctype="multipart/form-data" class="admin-form admin-block" id="section-game-images" data-section="section-game-images">
      <input type="hidden" name="section" value="game" />
      <div class="admin-section">
        <h3 data-i18n="admin_game_logo">Logo tr√≤ ch∆°i</h3>
        <div class="form-grid">
          <label><span data-i18n="admin_select_game">Ch·ªçn tr√≤ ch∆°i</span>
            <select name="game_slug">
              {% for game in games %}
                <option value="{{ game.slug }}">{{ game.name }}</option>
              {% endfor %}
            </select>
          </label>
          <label><span data-i18n="admin_upload_game_logo">T·∫£i logo tr√≤ ch∆°i</span>
            <input type="file" name="game_image" accept="image/*" />
          </label>
        </div>
        <label><input type="checkbox" name="clear_game_image" /> <span data-i18n="admin_clear_game_logo">X√≥a logo tr√≤ ch∆°i ƒë√£ ch·ªçn</span></label>

        <div class="game-preview-grid">
          {% for game in games %}
            <div class="game-preview-card">
              <div class="preview-title">{{ game.name }}</div>
              <label class="preview-edit">
                <span>S·ª≠a t√™n</span>
                <input type="text" name="game_name_{{ game.slug }}" value="{{ game.name }}" />
              </label>
              <div class="preview-image">
                {% if config.game_images.get(game.slug) %}
                  <img src="{{ config.game_images.get(game.slug) }}" alt="{{ game.name }}" />
                {% else %}
                  <div class="logo-badge">{{ game.name[:2] }}</div>
                {% endif %}
              </div>
              <button class="btn ghost" type="submit" name="delete_game_slug" value="{{ game.slug }}" data-i18n="admin_delete_image">X√≥a ·∫£nh</button>
            </div>
          {% endfor %}
        </div>
        <div class="admin-actions">
          <button class="btn primary" type="submit" data-i18n="admin_update_game_logo">C·∫≠p nh·∫≠t logo tr√≤ ch∆°i</button>
          <button class="btn ghost" type="submit" name="update_game_names" value="1">L∆∞u t√™n tr√≤ ch∆°i</button>
        </div>
      </div>
      </form>

      <form method="post" class="admin-form admin-block" id="section-config" data-section="section-config">
      <input type="hidden" name="section" value="marquee" />
      <div class="admin-section">
        <h3 data-i18n="admin_marquee">D√≤ng ch·∫°y l·ª£i nhu·∫≠n</h3>
        <label><span data-i18n="admin_marquee_content">N·ªôi dung hi·ªÉn th·ªã</span>
          <textarea name="marquee" rows="4">{{ config.marquee | join('\n') }}</textarea>
        </label>
        <label><span data-i18n="admin_marquee_speed">T·ªëc ƒë·ªô ch·∫°y (px/gi√¢y)</span>
          <div class="range-field">
            <input type="range" name="marquee_speed" min="0.2" max="1" step="0.1" value="{{ config.marquee_speed if config.marquee_speed is defined else 0.4 }}" data-range-output="marquee-speed-value" />
            <span id="marquee-speed-value" class="range-value">{{ config.marquee_speed if config.marquee_speed is defined else 0.4 }}</span>
          </div>
        </label>
        <div class="admin-actions">
          <button class="btn primary" type="submit" data-i18n="admin_save_content">L∆∞u n·ªôi dung</button>
        </div>
      </div>
      </form>

      <form method="post" enctype="multipart/form-data" class="admin-form admin-block" id="section-cskh-config" data-section="section-cskh-config">
      <input type="hidden" name="section" value="cskh_config" />
      <div class="admin-section">
        <h3 data-i18n="admin_cskh_config">C·∫•u h√¨nh CSKH</h3>
        <label><span data-i18n="admin_cskh_logo">Logo CSKH</span>
          <input type="file" name="cskh_logo" accept="image/*" />
        </label>
        {% if config.cskh_logo is defined and config.cskh_logo %}
          <div class="preview-row">
            <img src="{{ config.cskh_logo }}" alt="CSKH Logo" />
            <label><input type="checkbox" name="clear_cskh_logo" /> <span data-i18n="admin_clear_cskh_logo">X√≥a logo CSKH</span></label>
          </div>
        {% endif %}
        <label><span data-i18n="admin_cskh_notice">Th√¥ng b√°o tr√™n thanh CSKH</span>
          <input type="text" name="cskh_notice" value="{{ config.cskh_notice if config.cskh_notice is defined else '' }}" />
        </label>
        <div class="form-grid">
          <label><span data-i18n="admin_cskh_title">Ti√™u ƒë·ªÅ CSKH</span>
            <input type="text" name="cskh_title" value="{{ config.cskh_title if config.cskh_title is defined else '' }}" />
          </label>
          <label><span data-i18n="admin_cskh_subtitle">Ph·ª• ƒë·ªÅ CSKH</span>
            <input type="text" name="cskh_subtitle" value="{{ config.cskh_subtitle if config.cskh_subtitle is defined else '' }}" />
          </label>
        </div>
        <div class="form-grid">
          <label><span data-i18n="admin_cskh_self_title">Ti√™u ƒë·ªÅ t·ª± ph·ª•c v·ª•</span>
            <input type="text" name="cskh_self_title" value="{{ config.cskh_self_title if config.cskh_self_title is defined else '' }}" />
          </label>
          <label><span data-i18n="admin_cskh_self_subtitle">Ph·ª• ƒë·ªÅ t·ª± ph·ª•c v·ª•</span>
            <input type="text" name="cskh_self_subtitle" value="{{ config.cskh_self_subtitle if config.cskh_self_subtitle is defined else '' }}" />
          </label>
        </div>
        <label><span data-i18n="admin_cskh_banner_title">Ti√™u ƒë·ªÅ banner</span>
          <input type="text" name="cskh_banner_title" value="{{ config.cskh_banner_title if config.cskh_banner_title is defined else '' }}" />
        </label>
        <label><span data-i18n="admin_cskh_banner_desc">M√¥ t·∫£ banner</span>
          <textarea name="cskh_banner_text" rows="3">{{ config.cskh_banner_text if config.cskh_banner_text is defined else '' }}</textarea>
        </label>
        <label><span data-i18n="admin_cskh_quick_guides">H∆∞·ªõng d·∫´n nhanh (m·ªói d√≤ng 1 m·ª•c)</span>
          <textarea name="cskh_quick_guides" rows="4">{% if config.cskh_quick_guides is defined %}{{ config.cskh_quick_guides | join('\n') }}{% endif %}</textarea>
        </label>
        <div class="admin-actions">
          <button class="btn primary" type="submit" data-i18n="admin_save_cskh_config">L∆∞u c·∫•u h√¨nh CSKH</button>
        </div>
      </div>
        </form>
      </div>

      <section class="admin-links">
        <a class="btn ghost" href="{{ url_for('home') }}" data-i18n="admin_link_home">Link trang ch·ªß ng∆∞·ªùi d√πng</a>
        <a class="btn" href="{{ url_for('admin') }}" data-i18n="admin_link_admin">Link h·∫≠u ƒë√†i ch·ªânh s·ª≠a</a>
        <a class="btn ghost" href="{{ url_for('admin_logout') }}" data-i18n="admin_logout">ƒêƒÉng xu·∫•t h·∫≠u ƒë√†i</a>
      </section>

      <section class="admin-preview admin-block" id="section-theme" data-section="section-theme">
    <h3 data-i18n="admin_preview_title">Xem tr∆∞·ªõc giao di·ªán</h3>
    <div class="preview-actions">
      <a class="btn ghost" href="{{ url_for('home') }}" target="_blank" rel="noopener" data-i18n="admin_preview_pc">Xem PC</a>
      <a class="btn" href="{{ url_for('home') }}" target="_blank" rel="noopener" data-i18n="admin_preview_mobile">Xem Mobile</a>
    </div>
    <p class="note" data-i18n="admin_preview_note">D√πng c√¥ng c·ª• responsive c·ªßa tr√¨nh duy·ªát ƒë·ªÉ xem mobile chi ti·∫øt.</p>
      </section>

      <section class="admin-chat admin-block" id="section-cskh" data-section="section-cskh" data-reply-endpoint="{{ url_for('admin_cskh_reply') }}">
    <h3 data-i18n="admin_cskh_messages">CSKH - Tin nh·∫Øn ng∆∞·ªùi d√πng</h3>
    {% if chat_threads and chat_threads|length > 0 %}
      <div class="admin-chat-layout">
        <aside class="chat-thread-list">
          {% for thread in chat_threads %}
            <button class="chat-thread-item" type="button" data-chat-id="{{ thread.chat_id }}">
              <div class="thread-row">
                <div class="thread-title">{{ thread.username if thread.username else '·∫®n danh' }}</div>
                {% if thread.unread %}
                  <span class="unread-badge" data-i18n="admin_new">M·ªõi</span>
                {% endif %}
              </div>
              <div class="thread-meta">ID: {{ thread.user_id if thread.user_id else thread.chat_id }}</div>
              <div class="thread-preview">{{ thread.last_text if thread.last_text else 'Ch∆∞a c√≥ tin nh·∫Øn.' }}</div>
              <div class="thread-time">{{ thread.last_ts }}</div>
            </button>
          {% endfor %}
        </aside>
        <div class="chat-thread-detail">
          {% for thread in chat_threads %}
            <div class="chat-thread-card" data-chat-id="{{ thread.chat_id }}">
              <div class="chat-thread-header">
                <div>
                  <strong>{{ thread.username if thread.username else '·∫®n danh' }}</strong>
                  <div class="muted">ID: {{ thread.user_id if thread.user_id else thread.chat_id }}</div>
                </div>
                <span class="muted">{{ thread.last_ts }}</span>
              </div>
              <div class="chat-thread-body">
                {% for msg in thread.messages %}
                  <div class="chat-bubble {{ 'user' if msg.sender == 'user' else 'agent' }}">
                    {% if msg.text %}{{ msg.text }}{% endif %}
                    {% if msg.image %}
                      <img class="chat-image" src="{{ msg.image }}" alt="·∫¢nh" />
                    {% endif %}
                  </div>
                {% endfor %}
              </div>
              <div class="chat-thread-footer">
                <label class="upload-btn admin" for="admin-image-{{ thread.chat_id }}" data-i18n="image">·∫¢nh</label>
                <input type="file" class="chat-reply-image" id="admin-image-{{ thread.chat_id }}" accept="image/*" hidden />
                <input class="chat-reply-input" type="text" data-i18n-placeholder="admin_reply_placeholder" placeholder="Nh·∫≠p ph·∫£n h·ªìi cho kh√°ch h√†ng..." />
                <button class="btn ghost small admin-reply-btn" type="button" data-i18n="send">G·ª≠i</button>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% else %}
      <div class="muted" data-i18n="admin_no_messages">Ch∆∞a c√≥ tin nh·∫Øn CSKH.</div>
    {% endif %}
      </section>

      <section class="admin-placeholder admin-block" id="section-stats" data-section="section-stats">
    <h3 data-i18n="admin_stats">Th·ªëng k√™</h3>
    {% set pending = transactions|selectattr('status', 'equalto', 'pending')|list|length %}
    <div class="stats-grid">
      <div class="stat-box">
        <span data-i18n="admin_stat_users">Ng∆∞·ªùi d√πng</span>
        <strong>{{ users|length }}</strong>
      </div>
      <div class="stat-box">
        <span data-i18n="admin_stat_balance">T·ªïng s·ªë d∆∞</span>
        <strong>{{ total_balance }}$</strong>
      </div>
      <div class="stat-box">
        <span data-i18n="admin_stat_games">T·ªïng tr√≤ ch∆°i</span>
        <strong>{{ games|length }}</strong>
      </div>
      <div class="stat-box">
        <span data-i18n="admin_stat_pending">Ch·ªù duy·ªát</span>
        <strong>{{ pending }}</strong>
      </div>
    </div>
      </section>

      <section class="admin-placeholder admin-block" id="section-users" data-section="section-users">
    <h3 data-i18n="admin_users">T√†i kho·∫£n kh√°ch</h3>
    <div class="admin-table">
      <div class="table-row header six">
        <span data-i18n="admin_col_id">ID</span>
        <span data-i18n="admin_col_name">T√™n</span>
        <span data-i18n="admin_col_balance">S·ªë d∆∞</span>
        <span data-i18n="admin_col_status">Tr·∫°ng th√°i</span>
        <span data-i18n="admin_col_created">Ng√†y t·∫°o</span>
        <span data-i18n="admin_col_actions">Thao t√°c</span>
      </div>
      {% for user in users %}
        <div class="table-row six">
          <span>{{ user.id }}</span>
          <span>{{ user.username }}</span>
          <span>{{ user.balance }}$</span>
          <span>{{ user.status if user.status else 'active' }}</span>
          <span>{{ user.created_at }}</span>
          <span>
            <form class="inline-actions" method="post" action="{{ url_for('admin_toggle_user', user_id=user.id) }}">
              <button class="btn ghost small" type="submit">{{ 'M·ªü' if user.status == 'locked' else 'Kh√≥a' }}</button>
            </form>
            <form class="inline-actions" method="post" action="{{ url_for('admin_update_user_balance', user_id=user.id) }}">
              <input class="mini-input" type="number" name="balance" min="0" step="0.01" data-i18n-placeholder="admin_balance_placeholder" placeholder="S·ªë d∆∞" />
              <button class="btn ghost small" type="submit" data-i18n="admin_update">C·∫≠p nh·∫≠t</button>
            </form>
            <div class="inline-actions stacked">
              <div class="password-field mini">
                <input class="mini-input wide" type="text" value="{{ user.password if user.password else 'Ch∆∞a c√≥' }}" data-password="{{ user.password if user.password else '' }}" readonly />
                <button class="password-toggle" type="button" aria-label="·∫®n m·∫≠t kh·∫©u" aria-pressed="true">üôà</button>
              </div>
              <span class="muted">M·∫≠t kh·∫©u hi·ªán t·∫°i</span>
            </div>
            <form class="inline-actions stacked" method="post" action="{{ url_for('admin_update_user_password', user_id=user.id) }}">
              <div class="password-field mini">
                <input class="mini-input wide" type="password" name="new_password" data-i18n-placeholder="admin_new_password" placeholder="M·∫≠t kh·∫©u m·ªõi" />
                <button class="password-toggle" type="button" aria-label="Hi·ªán m·∫≠t kh·∫©u" aria-pressed="false">üëÅ</button>
              </div>
              <button class="btn ghost small" type="submit" data-i18n="admin_update_password">ƒê·ªïi m·∫≠t kh·∫©u</button>
            </form>
            <form class="inline-actions stacked" method="post" action="{{ url_for('admin_update_user_created_at', user_id=user.id) }}">
              <input class="mini-input wide" type="datetime-local" name="created_at" value="{{ (user.created_at or '')|replace(' ', 'T') }}" />
              <button class="btn ghost small" type="submit">S·ª≠a th·ªùi gian t·∫°o</button>
            </form>
            <form class="inline-actions stacked" method="post" action="{{ url_for('admin_update_user_bank', user_id=user.id) }}">
              <select class="mini-input wide" name="bank_name">
                <option value="" data-i18n="admin_bank_name">Ch·ªçn ng√¢n h√†ng</option>
                {% for bank in banks %}
                  <option value="{{ bank }}" {{ 'selected' if user.bank and user.bank.bank_name == bank else '' }}>{{ bank }}</option>
                {% endfor %}
              </select>
              <input class="mini-input wide" type="text" name="account_number" data-i18n-placeholder="admin_account_number" placeholder="S·ªë t√†i kho·∫£n" value="{{ user.bank.account_number if user.bank is defined and user.bank }}" />
              <input class="mini-input wide" type="text" name="full_name" data-i18n-placeholder="admin_account_holder" placeholder="Ch·ªß t√†i kho·∫£n" value="{{ user.bank.full_name if user.bank is defined and user.bank }}" />
              <input class="mini-input wide" type="text" name="phone" data-i18n-placeholder="admin_phone" placeholder="SƒêT" value="{{ user.bank.phone if user.bank is defined and user.bank }}" />
              <button class="btn ghost small" type="submit" data-i18n="admin_update_bank">C·∫≠p nh·∫≠t NH</button>
            </form>
          </span>
        </div>
      {% else %}
        <div class="muted" data-i18n="admin_no_users">Ch∆∞a c√≥ ng∆∞·ªùi d√πng.</div>
      {% endfor %}
    </div>
      </section>

      <section class="admin-placeholder admin-block" id="section-approval" data-section="section-approval">
    <h3>N·∫°p ti·ªÅn t√†i kho·∫£n</h3>
    <form class="inline-form" method="post" action="{{ url_for('admin_add_transaction') }}">
      <input type="hidden" name="tx_type" value="deposit" />
      <input type="hidden" name="tx_instant" value="1" />
      <label><span>ID ng∆∞·ªùi ch∆°i</span>
        <input type="text" name="tx_user_id" placeholder="ID ng∆∞·ªùi ch∆°i" />
      </label>
      <label>
        <span>&nbsp;</span>
        <button class="btn ghost small js-find-user" type="button">T√¨m ID</button>
      </label>
      <label><span data-i18n="admin_account">T√†i kho·∫£n</span>
        <select name="tx_username">
          <option value="" data-i18n="admin_select_account">Ch·ªçn t√†i kho·∫£n</option>
          {% for user in users %}
            <option value="{{ user.username }}" data-user-id="{{ user.id }}">{{ user.username }} ({{ user.id }})</option>
          {% endfor %}
        </select>
      </label>
      <label><span data-i18n="amount">S·ªë ti·ªÅn</span><input type="number" name="tx_amount" min="1" step="0.01" /></label>
      <button class="btn primary" type="submit">N·∫°p ti·ªÅn ngay</button>
    </form>

    <h3>T·∫°o y√™u c·∫ßu r√∫t</h3>
    <form class="inline-form" method="post" action="{{ url_for('admin_add_transaction') }}">
      <input type="hidden" name="tx_type" value="withdraw" />
      <label><span>ID ng∆∞·ªùi ch∆°i</span>
        <input type="text" name="tx_user_id" placeholder="ID ng∆∞·ªùi ch∆°i" />
      </label>
      <label><span data-i18n="admin_account">T√†i kho·∫£n</span>
        <select name="tx_username">
          <option value="" data-i18n="admin_select_account">Ch·ªçn t√†i kho·∫£n</option>
          {% for user in users %}
            <option value="{{ user.username }}" data-user-id="{{ user.id }}">{{ user.username }} ({{ user.id }})</option>
          {% endfor %}
        </select>
      </label>
      <label><span data-i18n="amount">S·ªë ti·ªÅn</span><input type="number" name="tx_amount" min="1" step="0.01" /></label>
      <button class="btn primary" type="submit">T·∫°o y√™u c·∫ßu r√∫t</button>
    </form>
    <div class="admin-table">
      <div class="table-row header six">
        <span data-i18n="admin_col_code">M√£</span>
        <span data-i18n="admin_tx_type">Lo·∫°i</span>
        <span data-i18n="admin_account">T√†i kho·∫£n</span>
        <span data-i18n="admin_col_amount">S·ªë ti·ªÅn</span>
        <span data-i18n="status_label">Tr·∫°ng th√°i</span>
        <span data-i18n="admin_col_actions">Thao t√°c</span>
      </div>
      {% for tx in transactions %}
        <div class="table-row six">
          <span>{{ tx.id }}</span>
          <span>{{ 'N·∫°p' if tx.type == 'deposit' else 'R√∫t' }}</span>
          <span>{{ tx.username }}</span>
          <span>{{ tx.amount }}$</span>
          <span>{{ tx.status }}</span>
          <span>
            {% if tx.status == 'pending' %}
              <form class="inline-actions" method="post" action="{{ url_for('admin_update_transaction', tx_id=tx.id, action='approve') }}">
                <button class="btn ghost small" type="submit" data-i18n="admin_approve">Duy·ªát</button>
              </form>
              <form class="inline-actions" method="post" action="{{ url_for('admin_update_transaction', tx_id=tx.id, action='reject') }}">
                <button class="btn ghost small" type="submit" data-i18n="admin_reject">T·ª´ ch·ªëi</button>
              </form>
            {% else %}
              <span class="muted">-</span>
            {% endif %}
          </span>
        </div>
      {% else %}
        <div class="muted" data-i18n="admin_no_transactions">Ch∆∞a c√≥ giao d·ªãch.</div>
      {% endfor %}
    </div>
      </section>

      <section class="admin-placeholder admin-block" id="section-banks" data-section="section-banks">
    <h3 data-i18n="admin_bank_info">Th√¥ng tin ng√¢n h√†ng</h3>
    <form method="post" action="{{ url_for('admin') }}">
          <label><span data-i18n="admin_bank_transfer_info">Th√¥ng tin chuy·ªÉn kho·∫£n</span>
            <textarea name="bank_transfer_info" rows="4" data-i18n-placeholder="admin_bank_transfer_placeholder" placeholder="V√≠ d·ª•: Ng√¢n h√†ng: Vietcombank\nCh·ªß TK: Nguyen Van A\nSTK: 123456789\nN·ªôi dung: NAP {{ '{{' }} username {{ '}}' }}">{{ config.bank_transfer_info }}</textarea>
          </label>
      <label><span data-i18n="admin_bank_list">Danh s√°ch ng√¢n h√†ng h·ªó tr·ª£</span>
        <textarea name="banks_config" rows="4" data-i18n-placeholder="admin_bank_list_placeholder" placeholder="V√≠ d·ª•: Vietcombank, BIDV, Momo">{{ config.banks_config }}</textarea>
      </label>
      <button class="btn primary" type="submit" data-i18n="admin_save_list">L∆∞u danh s√°ch</button>
    </form>
      </section>

      <section class="admin-placeholder admin-block" id="section-add-game" data-section="section-add-game">
    <h3 data-i18n="admin_add_game">Th√™m tr√≤ ch∆°i</h3>
    <form class="inline-form" method="post" action="{{ url_for('admin_add_game') }}">
      <label><span data-i18n="admin_game_name">T√™n tr√≤ ch∆°i</span><input type="text" name="game_name" data-i18n-placeholder="admin_game_name_placeholder" placeholder="T√™n tr√≤" /></label>
      <label><span data-i18n="admin_game_category">Ph√¢n lo·∫°i</span>
        <select name="game_category">
          <option value="casino" data-i18n="nav_casino">Casino</option>
          <option value="lottery" data-i18n="nav_lottery">X·ªï s·ªë</option>
        </select>
      </label>
      <button class="btn primary" type="submit" data-i18n="admin_add">Th√™m</button>
    </form>
      </section>

      <section class="admin-placeholder admin-block" id="section-edit-game" data-section="section-edit-game">
    <h3>S·ª≠a t√™n tr√≤ ch∆°i</h3>
    <form method="post" action="{{ url_for('admin') }}">
      <input type="hidden" name="section" value="edit_games" />
      <div class="form-grid">
        {% for game in games %}
          <label>
            <span>{{ game.slug }} ({{ game.category }})</span>
            <input type="text" name="game_name_{{ game.slug }}" value="{{ game.name }}" />
          </label>
        {% endfor %}
      </div>
      <button class="btn primary" type="submit">L∆∞u t√™n tr√≤ ch∆°i</button>
    </form>
      </section>

      <section class="admin-placeholder admin-block" id="section-bet-labels" data-section="section-bet-labels">
    <h3 data-i18n="admin_bet_labels">S·ª≠a t√™n c·ª≠a c∆∞·ª£c</h3>
    <form method="post" action="{{ url_for('admin') }}">
      <input type="hidden" name="section" value="bet_labels" />
      <input type="hidden" name="bet_pairs_count" value="{{ bet_pairs|length }}" />
      <div class="form-grid">
        {% for pair in bet_pairs %}
          <label>
            <span data-i18n="admin_bet_label_left">C·ª≠a tr√°i</span>
            <input type="text" name="bet_left_{{ loop.index0 }}" value="{{ pair.left }}" />
          </label>
          <label>
            <span data-i18n="admin_bet_label_right">C·ª≠a ph·∫£i</span>
            <input type="text" name="bet_right_{{ loop.index0 }}" value="{{ pair.right }}" />
          </label>
        {% endfor %}
      </div>
      <button class="btn primary" type="submit" data-i18n="admin_save_bet_labels">L∆∞u t√™n c·ª≠a c∆∞·ª£c</button>
    </form>
      </section>

      <section class="admin-placeholder admin-block" id="section-tips" data-section="section-tips">
    <h3 data-i18n="admin_tips">M·∫πo nh·ªè</h3>
    <form method="post" action="{{ url_for('admin') }}">
      <label><span data-i18n="admin_tips_content">N·ªôi dung m·∫πo nh·ªè</span>
        <textarea name="tips" rows="3" data-i18n-placeholder="admin_tips_placeholder" placeholder="Nh·∫≠p m·∫πo hi·ªÉn th·ªã cho qu·∫£n tr·ªã">{{ config.tips }}</textarea>
      </label>
      <button class="btn primary" type="submit" data-i18n="admin_save_tips">L∆∞u m·∫πo</button>
    </form>
      </section>

      <section class="admin-placeholder admin-block" id="section-fees" data-section="section-fees">
    <h3 data-i18n="admin_fees">T√≠nh tri ph√≠ n·∫°p r√∫t</h3>
    <form class="inline-form" method="post" action="{{ url_for('admin') }}">
      <label><span data-i18n="admin_fee_deposit">Ph√≠ n·∫°p (%)</span><input type="number" step="0.01" name="fee_deposit" value="{{ config.fee_deposit }}" /></label>
      <label><span data-i18n="admin_fee_withdraw">Ph√≠ r√∫t (%)</span><input type="number" step="0.01" name="fee_withdraw" value="{{ config.fee_withdraw }}" /></label>
      <button class="btn primary" type="submit" data-i18n="admin_save_fee">L∆∞u ph√≠</button>
    </form>
      </section>

      <section class="admin-placeholder admin-block" id="section-odds" data-section="section-odds">
    <h3 data-i18n="admin_odds">T√πy ch·ªânh odds theo t√†i kho·∫£n</h3>
    <form class="inline-form" method="post" action="{{ url_for('admin_update_user_odds') }}">
      <label><span data-i18n="admin_account">T√†i kho·∫£n</span>
        <select name="odds_user_id" required>
          <option value="" data-i18n="admin_select_account">Ch·ªçn t√†i kho·∫£n</option>
          {% for u in users %}
            <option value="{{ u.id }}">{{ u.username }} ({{ u.id }})</option>
          {% endfor %}
        </select>
      </label>
      <label><span data-i18n="admin_game">Tr√≤ ch∆°i</span>
        <select name="odds_game_slug" required>
          <option value="" data-i18n="admin_select_game">Ch·ªçn tr√≤ ch∆°i</option>
          {% for game in games %}
            <option value="{{ game.slug }}">{{ game.name }}</option>
          {% endfor %}
        </select>
      </label>
      <label><span data-i18n="admin_odds_low">Odds 1.98</span><input type="number" name="odds_low" step="0.01" min="1" value="{{ config.odds_low }}" /></label>
      <label><span data-i18n="admin_odds_high">Odds 2.1</span><input type="number" name="odds_high" step="0.01" min="1" value="{{ config.odds_high }}" /></label>
      <button class="btn primary" type="submit" data-i18n="admin_update_odds">C·∫≠p nh·∫≠t odds</button>
    </form>
    <p class="note" data-i18n="admin_odds_note">L∆∞u √Ω: M·ªói t√†i kho·∫£n c√≥ th·ªÉ c√≥ odds ri√™ng cho t·ª´ng tr√≤ ch∆°i.</p>
      </section>
    </div>
  </div>
</section>
{% endblock %}
