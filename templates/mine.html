{% extends "base.html" %}

{% block content %}
<section class="mine-header">
  <div class="avatar-card">
    <form class="avatar-form" method="post" enctype="multipart/form-data">
      <div class="avatar">
        {% if user and user.avatar %}
          <img src="{{ user.avatar }}" alt="Avatar" />
        {% else %}
          <div class="avatar-placeholder">+</div>
        {% endif %}
      </div>
      <input type="file" name="avatar" accept="image/*" />
      <button class="btn ghost" type="submit" data-i18n="upload_avatar">Táº£i avatar</button>
    </form>
    <div class="avatar-info">
      {% if user %}
        <h3>{{ user.username }}</h3>
        <div class="user-id-badge">
          <span data-i18n="user_id_label">ID</span>
          <strong>{{ user.id if user.id else '' }}</strong>
        </div>
      {% else %}
        <p data-i18n="please_login">Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ xem thÃ´ng tin.</p>
      {% endif %}
    </div>
    <button class="settings-btn" data-open="settings">âš™</button>
  </div>
</section>

<section class="wallet" id="withdraw">
  <div class="wallet-summary">
    <div>
      <h4 data-i18n="total_balance">Tá»•ng sá»‘ tiá»n</h4>
      <p class="amount">{{ '%.2f'|format(user.balance if user else 0) }}$</p>
    </div>
    <div class="wallet-stats">
      <p><span data-i18n="income">Thu nháº­p</span>: <strong>{{ '%.2f'|format(income_total if user else 0) }}</strong></p>
      <p><span data-i18n="profit_loss">Lá»£i nhuáº­n & thua lá»—</span>: <strong>{{ '%.2f'|format(profit_loss if user else 0) }}</strong></p>
    </div>
  </div>
  <div class="wallet-actions">
    <button class="btn primary" type="button" data-open="deposit-modal" data-i18n="deposit">Náº¡p tiá»n</button>
    <button class="btn ghost" type="button" data-open="withdraw-modal" data-i18n="withdraw">RÃºt tiá»n</button>
  </div>
</section>

<section class="records">
  <a class="record-card" href="{{ url_for('records', record_type='bet') }}" data-i18n="record_bet_history">Lá»‹ch sá»­ cÆ°á»£c</a>
  <a class="record-card" href="{{ url_for('records', record_type='deposit') }}" data-i18n="record_deposit_history">Há»“ sÆ¡ náº¡p tiá»n</a>
  <a class="record-card" href="{{ url_for('records', record_type='withdraw') }}" data-i18n="record_withdraw_history">Há»“ sÆ¡ rÃºt tiá»n</a>
  <a class="record-card" href="{{ url_for('records', record_type='traffic') }}" data-i18n="record_traffic">Báº£n ghi lÆ°u lÆ°á»£ng</a>
  <a class="record-card" href="{{ url_for('records', record_type='account') }}" data-i18n="record_account">ThÃ´ng tin tÃ i khoáº£n</a>
  <a class="record-card" href="{{ url_for('cskh') }}" data-i18n="record_cskh">Dá»‹ch vá»¥ CSKH</a>
  <a class="record-card" href="{{ url_for('records', record_type='rebate') }}" data-i18n="record_rebate">Báº£n chi láº¡i</a>
  <a class="record-card" href="{{ url_for('records', record_type='created') }}" data-i18n="record_created">Thá»i gian táº¡o tÃ i khoáº£n</a>
</section>


<div class="modal" id="settings">
  <div class="modal-content">
    <h3 data-i18n="settings_title">CÃ i Ä‘áº·t</h3>
    <label><span data-i18n="change_language">Äá»•i ngÃ´n ngá»¯</span>
      <select id="language-select">
        <option value="vi">Tiáº¿ng Viá»‡t</option>
        <option value="en">English</option>
        <option value="zh">ä¸­æ–‡</option>
        <option value="ja">æ—¥æœ¬èª</option>
        <option value="ko">í•œêµ­ì–´</option>
        <option value="th">à¹„à¸—à¸¢</option>
        <option value="fr">FranÃ§ais</option>
        <option value="es">EspaÃ±ol</option>
      </select>
    </label>
    <label><span data-i18n="font_size">Chá»‰nh cá»¡ chá»¯</span>
      <input type="range" id="font-size" min="14" max="22" value="16" />
    </label>
    <div class="settings-actions">
      <button class="btn ghost" type="button" data-open="password-modal" data-i18n="change_password">Äá»•i máº­t kháº©u</button>
      <button class="btn ghost" type="button" data-open="withdraw-password-modal" data-i18n="change_withdraw_password">Äá»•i máº­t kháº©u rÃºt tiá»n</button>
      <a class="btn" href="{{ url_for('logout') }}" data-i18n="logout">ÄÄƒng xuáº¥t</a>
    </div>
    <button class="modal-close" data-close="settings" data-i18n="close">ÄÃ³ng</button>
  </div>
</div>

<div class="modal" id="withdraw-modal">
  <div class="modal-content">
    <h3 data-i18n="withdraw">RÃºt tiá»n</h3>
    {% if not user %}
      <p data-i18n="please_login">Vui lÃ²ng Ä‘Äƒng nháº­p trÆ°á»›c.</p>
    {% elif not user.bank %}
      <p data-i18n="withdraw_need_bank">Báº¡n chÆ°a liÃªn káº¿t ngÃ¢n hÃ ng. Vui lÃ²ng liÃªn káº¿t Ä‘á»ƒ tiáº¿p tá»¥c rÃºt tiá»n.</p>
      <div class="bank-link inside-modal">
        <h4 data-i18n="bank_link_title">LiÃªn káº¿t ngÃ¢n hÃ ng</h4>
        <form method="post">
          <div class="form-grid compact">
            <label><span data-i18n="full_name">Há» vÃ  tÃªn</span><input type="text" name="full_name" required /></label>
            <label><span data-i18n="phone">Sá»‘ Ä‘iá»‡n thoáº¡i</span><input type="text" name="phone" required /></label>
            <label><span data-i18n="bank_account">Sá»‘ tÃ i khoáº£n ngÃ¢n hÃ ng</span><input type="text" name="account_number" required /></label>
            <label><span data-i18n="bank_name">TÃªn ngÃ¢n hÃ ng</span>
              <select name="bank_name" required>
                {% for bank in banks %}
                  <option value="{{ bank }}">{{ bank }}</option>
                {% endfor %}
              </select>
            </label>
          </div>
          <div class="notice">
            <p data-i18n="bank_notice_1">1. TÃªn tháº­t cáº§n trÃ¹ng khá»›p vá»›i tÃªn tháº» ngÃ¢n hÃ ng.</p>
            <p data-i18n="bank_notice_2">2. Ngoáº¡i trá»« tÃªn hiá»‡u, cÃ¡c dá»¯ liá»‡u khÃ¡c khÃ´ng thá»ƒ sá»­a sau khi lÆ°u.</p>
          </div>
          <button class="btn primary" type="submit" data-i18n="save_bank_link">LÆ°u liÃªn káº¿t</button>
        </form>
      </div>
    {% else %}
      <div class="form-grid compact">
        <label><span data-i18n="username_label">TÃªn ngÆ°á»i dÃ¹ng</span><input type="text" value="{{ user.username }}" disabled /></label>
        <label><span data-i18n="bank_name">NgÃ¢n hÃ ng</span><input type="text" value="{{ user.bank.bank_name }}" disabled /></label>
        <label><span data-i18n="phone">Sá»‘ Ä‘iá»‡n thoáº¡i</span><input type="text" value="{{ user.bank.phone if user.bank and user.bank.phone else user.phone }}" disabled /></label>
      </div>
      <p data-i18n="withdraw_min">Sá»‘ dÆ° tá»‘i thiá»ƒu: 100$</p>
      <label><span data-i18n="amount">Sá»‘ tiá»n</span><input type="number" min="1" id="withdraw-amount" /></label>
      {% if not user.withdraw_password %}
        <label><span data-i18n="withdraw_password_new">Máº­t kháº©u rÃºt tiá»n má»›i</span>
          <div class="password-field">
            <input type="password" id="withdraw-password-new" />
            <button class="password-toggle" type="button" aria-label="Hiá»‡n máº­t kháº©u" aria-pressed="false">ğŸ‘</button>
          </div>
        </label>
        <label><span data-i18n="withdraw_password_confirm">Nháº­p láº¡i máº­t kháº©u</span>
          <div class="password-field">
            <input type="password" id="withdraw-password-confirm" />
            <button class="password-toggle" type="button" aria-label="Hiá»‡n máº­t kháº©u" aria-pressed="false">ğŸ‘</button>
          </div>
        </label>
      {% else %}
        <label><span data-i18n="withdraw_password">Máº­t kháº©u rÃºt tiá»n</span>
          <div class="password-field">
            <input type="password" id="withdraw-password" />
            <button class="password-toggle" type="button" aria-label="Hiá»‡n máº­t kháº©u" aria-pressed="false">ğŸ‘</button>
          </div>
        </label>
      {% endif %}
      <button class="btn primary" type="button" id="withdraw-submit" data-i18n="submit_request">Gá»­i yÃªu cáº§u</button>
    {% endif %}
    <button class="modal-close" data-close="withdraw-modal" data-i18n="close">ÄÃ³ng</button>
  </div>
</div>

<div class="modal" id="deposit-modal">
  <div class="modal-content">
    <h3 data-i18n="deposit">Náº¡p tiá»n</h3>
    <p data-i18n="deposit_note">Vui lÃ²ng nháº­p sá»‘ tiá»n vÃ  ghi chÃº (náº¿u cÃ³).</p>
    <label><span data-i18n="amount">Sá»‘ tiá»n</span><input type="number" min="1" id="deposit-amount" /></label>
    <label><span data-i18n="note">Ghi chÃº</span><input type="text" id="deposit-note" data-i18n-placeholder="deposit_placeholder" placeholder="MÃ£ giao dá»‹ch / ná»™i dung chuyá»ƒn" /></label>
    {% if config.bank_transfer_info %}
      <div class="bank-info">
        <strong data-i18n="bank_transfer_info">ThÃ´ng tin chuyá»ƒn khoáº£n</strong>
        <pre>{{ config.bank_transfer_info }}</pre>
      </div>
    {% elif config.banks_config %}
      <div class="notice"><span data-i18n="supported_banks">NgÃ¢n hÃ ng há»— trá»£</span>: {{ config.banks_config }}</div>
    {% endif %}
    <button class="btn primary" type="button" id="deposit-submit" data-i18n="submit_request">Gá»­i yÃªu cáº§u</button>
    <button class="modal-close" data-close="deposit-modal" data-i18n="close">ÄÃ³ng</button>
  </div>
</div>

<div class="modal" id="password-modal">
  <div class="modal-content">
    <h3 data-i18n="change_login_password">Äá»•i máº­t kháº©u Ä‘Äƒng nháº­p</h3>
    <label><span data-i18n="new_password">Máº­t kháº©u má»›i</span>
      <div class="password-field">
        <input type="password" />
        <button class="password-toggle" type="button" aria-label="Hiá»‡n máº­t kháº©u" aria-pressed="false">ğŸ‘</button>
      </div>
    </label>
    <button class="btn primary" type="button" data-i18n="update">Cáº­p nháº­t</button>
    <button class="modal-close" data-close="password-modal" data-i18n="close">ÄÃ³ng</button>
  </div>
</div>

<div class="modal" id="withdraw-password-modal">
  <div class="modal-content">
    <h3 data-i18n="create_withdraw_password">Táº¡o máº­t kháº©u rÃºt tiá»n</h3>
    <label><span data-i18n="withdraw_password">Máº­t kháº©u rÃºt tiá»n</span>
      <div class="password-field">
        <input type="password" id="withdraw-password-new" />
        <button class="password-toggle" type="button" aria-label="Hiá»‡n máº­t kháº©u" aria-pressed="false">ğŸ‘</button>
      </div>
    </label>
    <button class="btn primary" type="button" id="withdraw-password-submit" data-i18n="create_password">Táº¡o máº­t kháº©u</button>
    <button class="modal-close" data-close="withdraw-password-modal" data-i18n="close">ÄÃ³ng</button>
  </div>
</div>
{% endblock %}
